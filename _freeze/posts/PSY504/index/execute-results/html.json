{
  "hash": "0801488d70543db987cfe50fb6f13380",
  "result": {
    "markdown": "---\ntitle: \"Mediation Analysis in R\"\nexecute:\n  output: false\ndescripton: \"PSY504 Final Project\"\nauthor: \"Claire Whiting\"\ndate: \"2023-05-16\"\ncategories: [R]\n\nwebsite:\n  title: \"Claire Whiting\"\n  navbar:\n    title: false\n    right:\n      - href: index.qmd\n        text: Home\n      - text: CV\n        file: cv.pdf\n      - posts.qmd\n      - icon: github\n        href: https://github.com/claire-whiting\n      - icon: twitter\n        href: https://twitter.com/claire_whiting\n  page-footer: \n    background: light\n    left: \n      - icon: github\n        href: https://github.com/claire-whiting\n      - icon: twitter\n        href: https://twitter.com/claire_whiting\n      - icon: envelope\n        href: mailto:claire.whiting@princeton.edu\n        \nformat:\n  html:\n    theme: cosmo\n---\n\n\n### Intro\n\nHere, I'll provide a walkthrough of a mediation analysis, along with some initial statistical tests. This example uses data from a study examining the effects of a linguistic distancing manipulation on reappraisal efficacy in a sample of adolescents. Participants were randomized into control and distanced groups before completing a cognitive reappraisal exercise. The distanced group were instructed to avoid using the word \"I\" and the present tense, while the control group received no specific instructions. Affect was measured both pre- and post-reappraisal on a sliding scale from Very Bad (-100) to Very Good (100). The pre-post change in affect was used as our outcome measure of reappraisal success.\n\nThese are the 4 questions we wanted to test:\n\n1.  Does linguistic distancing differ by condition?\n2.  Is linguistic distancing correlated with affect change?\n3.  Does affect change differ by condition?\n4.  Does linguistic distancing mediate the association between condition and affect change?\n\n\\[image of mediation model\\]\n\n### Environment set-up\n\nFirst, lets load in all the packages we need. If you don't have a package installed, you can run [install_packages('packagename')]{style=\"color:blue;\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(dplyr)\nlibrary(lsr)\nlibrary(mediation)\nlibrary(datawizard)\nlibrary(report)\nlibrary(knitr) # For nice tables\nlibrary(kableExtra) # For nice tables\nlibrary(ggplot2) # For nice plots\n```\n:::\n\n\nNext, load in your data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata <- read_csv(\"data.csv\")\n```\n:::\n\n\nMy data contains the following variables:\n\nI**D**: Participant ID\n\n**Condition**: 0 for control group, 1 for distanced group\n\n**Duration_minutes**: Number of minutes taken to complete task\n\n**psychdist**: Score for linguistic distance\n\n**affect_change**: Change in affect from pre- to post-reappraisal\n\n**WC**: Total word count for reappraisal response\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nhead(data) %>%\n  kable()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> ID </th>\n   <th style=\"text-align:right;\"> Condition </th>\n   <th style=\"text-align:right;\"> Duration_minutes </th>\n   <th style=\"text-align:right;\"> psychdist </th>\n   <th style=\"text-align:right;\"> affect_change </th>\n   <th style=\"text-align:right;\"> WC </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 401.0130 </td>\n   <td style=\"text-align:right;\"> -0.6245898 </td>\n   <td style=\"text-align:right;\"> 30.27715 </td>\n   <td style=\"text-align:right;\"> 42.59283 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 488.1809 </td>\n   <td style=\"text-align:right;\"> 0.2759279 </td>\n   <td style=\"text-align:right;\"> 18.67820 </td>\n   <td style=\"text-align:right;\"> 115.21387 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 3 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 595.5391 </td>\n   <td style=\"text-align:right;\"> 0.6519053 </td>\n   <td style=\"text-align:right;\"> 109.55336 </td>\n   <td style=\"text-align:right;\"> 48.47611 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 4 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1231.6437 </td>\n   <td style=\"text-align:right;\"> 0.1463954 </td>\n   <td style=\"text-align:right;\"> 35.20107 </td>\n   <td style=\"text-align:right;\"> 79.69326 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 5 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 716.5663 </td>\n   <td style=\"text-align:right;\"> -0.0147644 </td>\n   <td style=\"text-align:right;\"> 57.21294 </td>\n   <td style=\"text-align:right;\"> 33.10408 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 6 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> -491.8542 </td>\n   <td style=\"text-align:right;\"> 0.1977090 </td>\n   <td style=\"text-align:right;\"> 36.91108 </td>\n   <td style=\"text-align:right;\"> 121.86949 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n### Question 1. Does linguistic distancing differ by condition?\n\nWe can use a t-test to find out whether the linguistic distancing manipulation worked as expected i.e., whether the distanced group had higher distancing scores compared to the control group. The effect size can be measured using the Cohen's d statistic.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Does linguistic distancing differ by condition?\nt.test(psychdist ~ Condition, data=data)\ncohensD(psychdist ~ Condition, data=data)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nt.test(psychdist ~ Condition, data=data) %>%\n  report_table() %>%\n  summary()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nDifference |         95% CI | t(996.08) |      p |     d\n--------------------------------------------------------\n-0.22      | [-0.28, -0.15] |     -6.60 | < .001 | -0.42\n\nAlternative hypothesis: two.sided\n```\n:::\n:::\n\n\nThere is a significant difference between the two groups, *p* \\< .001, d = .42.\n\nWe can visualize this difference using a bar plot. Here, I first calcualate the 95% confidence intervals, so we can show these on the plot. Then I use [ggplot]{style=\"color:blue;\"} to create the plot - take a look at the comments to see what each line of code is doing.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlingdist_msd <- data %>%\n  dplyr::select(ID, Condition, psychdist) %>%\n  na.omit() %>% # Remove any missing values\n  group_by(Condition) %>%\n  summarize(mean = mean(psychdist), # Mean\n            sd = sd(psychdist), # Standard deviation\n            se = sd / sqrt(n()), # Standard error\n            CI_lower = mean - (1.96 * se), # Lower CI bound\n            CI_upper = mean + (1.96 * se)) %>% # Upper CI bound\n  mutate(Condition = as.factor(Condition))\n\n\nggplot(lingdist_msd, aes(x=Condition, y=mean)) + # Input variables\n  geom_bar(position=position_dodge(), stat=\"identity\", # Add bars\n           fill=\"#4b5e9c\") +\n  geom_errorbar(aes(ymin=CI_lower, ymax=CI_upper), width=.2) + # Add CI bars\n  scale_x_discrete(labels=c('Control', \n                            'Distanced')) + # Rename x axis labels\n  coord_cartesian(ylim=c(-0.2, 0.2)) + # Set y axis limits\n  ylab(\"Mean Linguistic Distance\") + xlab(\"\") + # Set axes labels\n  theme_light(base_size=20) # Set plot theme and font size\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n### Question 2. Is linguistic distancing correlated with affect change?\n\nWe can use a Pearson's correlation test to answer this question. Note, this analysis is across all participants.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncor.test(data$psychdist, data$affect_change)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\ncor.test(data$psychdist, data$affect_change) %>%\n  report_table()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nPearson's product-moment correlation\n\nParameter1     |         Parameter2 |    r |       95% CI | t(998) |      p\n---------------------------------------------------------------------------\ndata$psychdist | data$affect_change | 0.15 | [0.09, 0.21] |   4.88 | < .001\n\nAlternative hypothesis: two.sided\n```\n:::\n:::\n\n\nThese results show that there is a significant positive correlation between linguistic distancing and affect change, *p* < .001.\n\nWe can plot the correlation with a scatterplot, again using [ggplot]{style=\"color:blue;\"}.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data, aes(x=psychdist, y=affect_change)) + # Input variables\n  geom_point(alpha=0.5) + # Add points/dots\n  geom_smooth(method=\"lm\") + # Add regression line\n  xlab(\"Linguistic Distance\") + ylab(\"Affect Change\") + # Axes labels\n  theme_light(base_size=20) # Theme and font size\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n### Question 3. Does affect change differ by condition?\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Does affect change differ by condition?\n\nt.test(affect_change ~ Condition, data=data)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\naffect_change_msd <- data %>%\n  dplyr::select(ID, Condition, affect_change) %>%\n  rename(Change = affect_change) %>%\n  group_by(Condition) %>%\n  summarize(mean = mean(Change),\n            sd = sd(Change),\n            se = sd / sqrt(n()),\n            CI_lower = mean - (1.96 * se),\n            CI_upper = mean + (1.96 * se)) %>%\n  mutate(Condition = as.factor(Condition))\n\nggplot(affect_change_msd, aes(x=Condition, y=mean)) + \n  geom_bar(position=position_dodge(), stat=\"identity\",\n           fill=\"#4b5e9c\") +\n  geom_errorbar(aes(ymin=CI_lower, ymax=CI_upper), width=.2) +\n  scale_x_discrete(labels=c('Control', \n                            'Distanced')) +\n  coord_cartesian(ylim=c(0,70)) +\n  ylab(\"Mean Affect Change\") + xlab(\"\") +\n  theme_light(base_size=20)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n### Question 4. Does linguistic distancing mediate the association between condition and affect change?\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create standardized variables\ndata <- data %>% \n  mutate(affect_change_z = datawizard::standardize(affect_change),\n         psychdist_z = datawizard::standardize(psychdist))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nhead(data) %>%\n  kable()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> ID </th>\n   <th style=\"text-align:right;\"> Condition </th>\n   <th style=\"text-align:right;\"> Duration_minutes </th>\n   <th style=\"text-align:right;\"> psychdist </th>\n   <th style=\"text-align:right;\"> affect_change </th>\n   <th style=\"text-align:right;\"> WC </th>\n   <th style=\"text-align:right;\"> affect_change_z </th>\n   <th style=\"text-align:right;\"> psychdist_z </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 401.0130 </td>\n   <td style=\"text-align:right;\"> -0.6245898 </td>\n   <td style=\"text-align:right;\"> 30.27715 </td>\n   <td style=\"text-align:right;\"> 42.59283 </td>\n   <td style=\"text-align:right;\"> -0.49316131 </td>\n   <td style=\"text-align:right;\"> -1.20988948 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 488.1809 </td>\n   <td style=\"text-align:right;\"> 0.2759279 </td>\n   <td style=\"text-align:right;\"> 18.67820 </td>\n   <td style=\"text-align:right;\"> 115.21387 </td>\n   <td style=\"text-align:right;\"> -0.71044376 </td>\n   <td style=\"text-align:right;\"> 0.49508786 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 3 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 595.5391 </td>\n   <td style=\"text-align:right;\"> 0.6519053 </td>\n   <td style=\"text-align:right;\"> 109.55336 </td>\n   <td style=\"text-align:right;\"> 48.47611 </td>\n   <td style=\"text-align:right;\"> 0.99191628 </td>\n   <td style=\"text-align:right;\"> 1.20693716 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 4 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1231.6437 </td>\n   <td style=\"text-align:right;\"> 0.1463954 </td>\n   <td style=\"text-align:right;\"> 35.20107 </td>\n   <td style=\"text-align:right;\"> 79.69326 </td>\n   <td style=\"text-align:right;\"> -0.40092173 </td>\n   <td style=\"text-align:right;\"> 0.24984013 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 5 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 716.5663 </td>\n   <td style=\"text-align:right;\"> -0.0147644 </td>\n   <td style=\"text-align:right;\"> 57.21294 </td>\n   <td style=\"text-align:right;\"> 33.10408 </td>\n   <td style=\"text-align:right;\"> 0.01142558 </td>\n   <td style=\"text-align:right;\"> -0.05528865 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 6 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> -491.8542 </td>\n   <td style=\"text-align:right;\"> 0.1977090 </td>\n   <td style=\"text-align:right;\"> 36.91108 </td>\n   <td style=\"text-align:right;\"> 121.86949 </td>\n   <td style=\"text-align:right;\"> -0.36888816 </td>\n   <td style=\"text-align:right;\"> 0.34699367 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Mediation analysis\n\nfit.totaleffect = lm(affect_change_z ~ Condition, data)\nsummary(fit.totaleffect) \n\nfit.mediator =  lm(psychdist_z ~ Condition, data)\nsummary(fit.mediator) \n\nfit.dv = lm(affect_change_z ~ Condition + psychdist_z, data)\nsummary(fit.dv)\n\nset.seed(123)\n#results = mediation::mediate(fit.mediator, fit.dv, treat='Condition', mediator='psychdist_z', sims = 10000, boot=T, boot.ci.type = \"bca\")\n#summary(results)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Exploring word count\n\nt.test(WC ~ Condition, data=data) \ncohensD(WC ~ Condition, data=data)\nsummary(lm(affect_change ~ WC*Condition, data=data)) \n```\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}