{
  "hash": "188c9ba6be16d8ae7cf8535311f67454",
  "result": {
    "markdown": "---\ntitle: \"Mediation Analysis in R\"\nexecute:\n  output: false\ndescripton: \"PSY504 Final Project\"\nauthor: \"Claire Whiting\"\ndate: \"2023-05-16\"\ncategories: [R]\n\nwebsite:\n  title: \"Claire Whiting\"\n  navbar:\n    title: false\n    right:\n      - href: index.qmd\n        text: Home\n      - text: CV\n        file: cv.pdf\n      - posts.qmd\n      - icon: github\n        href: https://github.com/claire-whiting\n      - icon: twitter\n        href: https://twitter.com/claire_whiting\n  page-footer: \n    background: light\n    left: \n      - icon: github\n        href: https://github.com/claire-whiting\n      - icon: twitter\n        href: https://twitter.com/claire_whiting\n      - icon: envelope\n        href: mailto:claire.whiting@princeton.edu\n---\n\n\n### Intro\n\nHere, I'll provide a walkthrough of the analyses I ran for a mediation study. This example uses data from a study examining the effects of a linguistic distancing manipulation on reappraisal efficacy in a sample of adolescents. Participants were randomized into control and distanced groups before completing a cognitive reappraisal exercise. The distanced group were instructed to avoid using the word \"I\" and the present tense, while the control group received no specific instructions. Affect was measured both pre- and post-reappraisal on a sliding scale from Very Bad (-100) to Very Good (100). The pre-post change in affect was used as our outcome measure of reappraisal success. See [osf.io/5pvfh](https://osf.io/5pvfh) for more details.\n\nThese are the 4 questions we wanted to test:\n\n1.  Does linguistic distancing differ by condition?\n2.  Is linguistic distancing correlated with affect change?\n3.  Does affect change differ by condition?\n4.  Does linguistic distancing mediate the association between condition and affect change? (see figure below)\n\n![](mediation.png){fig-align=\"center\" width=\"80%\"}\n\n### Environment set-up\n\nFirst, lets load in all the packages we need. If you don't have a package installed, you can run [install_packages('packagename')]{style=\"color:blue;\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(dplyr)\nlibrary(lsr)\nlibrary(mediation)\nlibrary(datawizard)\nlibrary(report)\nlibrary(knitr) # For nice tables\nlibrary(kableExtra) # For nice tables\nlibrary(ggplot2) # For nice plots\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\noptions(scipen=999, digits=3)\n```\n:::\n\n\nNext, load in your data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata <- read_csv(\"data.csv\")\n```\n:::\n\n\nMy data contains the following variables:\n\n**ID**: Participant ID\n\n**Condition**: 0 for control group, 1 for distanced group\n\n**Duration_minutes**: Number of minutes taken to complete task\n\n**psychdist**: Score for linguistic distance\n\n**affect_change**: Change in affect from pre- to post-reappraisal\n\n**WC**: Total word count for reappraisal response\n\nHere are the first 6 participants in the dataset:\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nhead(data) %>%\n  kable()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> ID </th>\n   <th style=\"text-align:right;\"> Condition </th>\n   <th style=\"text-align:right;\"> Duration_minutes </th>\n   <th style=\"text-align:right;\"> psychdist </th>\n   <th style=\"text-align:right;\"> affect_change </th>\n   <th style=\"text-align:right;\"> WC </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 401 </td>\n   <td style=\"text-align:right;\"> -0.625 </td>\n   <td style=\"text-align:right;\"> 30.3 </td>\n   <td style=\"text-align:right;\"> 42.6 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 488 </td>\n   <td style=\"text-align:right;\"> 0.276 </td>\n   <td style=\"text-align:right;\"> 18.7 </td>\n   <td style=\"text-align:right;\"> 115.2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 3 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 596 </td>\n   <td style=\"text-align:right;\"> 0.652 </td>\n   <td style=\"text-align:right;\"> 109.6 </td>\n   <td style=\"text-align:right;\"> 48.5 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 4 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1232 </td>\n   <td style=\"text-align:right;\"> 0.146 </td>\n   <td style=\"text-align:right;\"> 35.2 </td>\n   <td style=\"text-align:right;\"> 79.7 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 5 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 717 </td>\n   <td style=\"text-align:right;\"> -0.015 </td>\n   <td style=\"text-align:right;\"> 57.2 </td>\n   <td style=\"text-align:right;\"> 33.1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 6 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> -492 </td>\n   <td style=\"text-align:right;\"> 0.198 </td>\n   <td style=\"text-align:right;\"> 36.9 </td>\n   <td style=\"text-align:right;\"> 121.9 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n### Question 1. Does linguistic distancing differ by condition?\n\nWe can use a t-test to find out whether the linguistic distancing manipulation worked as expected i.e., whether the distanced group had higher distancing scores compared to the control group. The effect size can be measured using the Cohen's d statistic.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Does linguistic distancing differ by condition?\nt.test(psychdist ~ Condition, data=data)\ncohensD(psychdist ~ Condition, data=data)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nt.test(psychdist ~ Condition, data=data) %>%\n  report_table() %>%\n  summary()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nDifference |         95% CI | t(996.08) |      p |     d\n--------------------------------------------------------\n-0.22      | [-0.28, -0.15] |     -6.60 | < .001 | -0.42\n\nAlternative hypothesis: two.sided\n```\n:::\n:::\n\n\nThere is a significant difference between the two groups, *p* \\< .001, d = .42.\n\nWe can visualize this difference using a bar plot. Here, I first calcualate the 95% confidence intervals, so we can show these on the plot. Then I use [ggplot]{style=\"color:blue;\"} to create the plot - take a look at the comments to see what each line of code is doing.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlingdist_msd <- data %>%\n  dplyr::select(ID, Condition, psychdist) %>%\n  na.omit() %>% # Remove any missing values\n  group_by(Condition) %>%\n  summarize(mean = mean(psychdist), # Mean\n            sd = sd(psychdist), # Standard deviation\n            se = sd / sqrt(n()), # Standard error\n            CI_lower = mean - (1.96 * se), # Lower CI bound\n            CI_upper = mean + (1.96 * se)) %>% # Upper CI bound\n  mutate(Condition = as.factor(Condition))\n\n\nggplot(lingdist_msd, aes(x=Condition, y=mean)) + # Input variables\n  geom_bar(position=position_dodge(), stat=\"identity\", # Add bars\n           fill=\"#4b5e9c\") +\n  geom_errorbar(aes(ymin=CI_lower, ymax=CI_upper), width=.2) + # Add CI bars\n  scale_x_discrete(labels=c('Control', \n                            'Distanced')) + # Rename x axis labels\n  coord_cartesian(ylim=c(-0.2, 0.2)) + # Set y axis limits\n  ylab(\"Mean Linguistic Distance\") + xlab(\"\") + # Set axes labels\n  theme_light(base_size=20) # Set plot theme and font size\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n### Question 2. Is linguistic distancing correlated with affect change?\n\nWe can use a Pearson's correlation test to answer this question. Note, this analysis is across all participants.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncor.test(data$psychdist, data$affect_change)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\ncor.test(data$psychdist, data$affect_change) %>%\n  report_table()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nPearson's product-moment correlation\n\nParameter1     |         Parameter2 |    r |       95% CI | t(998) |      p\n---------------------------------------------------------------------------\ndata$psychdist | data$affect_change | 0.15 | [0.09, 0.21] |   4.88 | < .001\n\nAlternative hypothesis: two.sided\n```\n:::\n:::\n\n\nThese results show that there is a significant positive correlation between linguistic distancing and affect change, *p* \\< .001.\n\nWe can plot the correlation with a scatterplot, again using [ggplot]{style=\"color:blue;\"}.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data, aes(x=psychdist, y=affect_change)) + # Input variables\n  geom_point(alpha=0.5) + # Add points/dots\n  geom_smooth(method=\"lm\") + # Add regression line\n  xlab(\"Linguistic Distance\") + ylab(\"Affect Change\") + # Axes labels\n  theme_light(base_size=20) # Theme and font size\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n### Question 3. Does affect change differ by condition?\n\nWe expected that the groups would differ on affect change - we hypothesized that the distanced group would show a greater affect change than the control group. To test this, we can use a t-test:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Does affect change differ by condition?\n\nt.test(affect_change ~ Condition, data=data)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nt.test(affect_change ~ Condition, data=data) %>%\n  report_table() %>%\n  summary()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nDifference |        95% CI | t(994.24) |     p |     d\n------------------------------------------------------\n-2.39      | [-9.02, 4.23] |     -0.71 | 0.479 | -0.04\n\nAlternative hypothesis: two.sided\n```\n:::\n:::\n\n\nThere is actually no statistically significant difference between the two groups, *p* = .479. We can again visualize the two groups using a bar plot:\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\naffect_change_msd <- data %>%\n  dplyr::select(ID, Condition, affect_change) %>%\n  rename(Change = affect_change) %>%\n  group_by(Condition) %>%\n  summarize(mean = mean(Change),\n            sd = sd(Change),\n            se = sd / sqrt(n()),\n            CI_lower = mean - (1.96 * se),\n            CI_upper = mean + (1.96 * se)) %>%\n  mutate(Condition = as.factor(Condition))\n\nggplot(affect_change_msd, aes(x=Condition, y=mean)) + \n  geom_bar(position=position_dodge(), stat=\"identity\",\n           fill=\"#4b5e9c\") +\n  geom_errorbar(aes(ymin=CI_lower, ymax=CI_upper), width=.2) +\n  scale_x_discrete(labels=c('Control', \n                            'Distanced')) +\n  coord_cartesian(ylim=c(0,70)) +\n  ylab(\"Mean Affect Change\") + xlab(\"\") +\n  theme_light(base_size=20)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n### Question 4. Does linguistic distancing mediate the association between condition and affect change?\n\nNow for the mediation analysis! First, lets standardize our continuous variables (linguistic distance and affect change) using the [datawizard]{style=\"color:blue;\"} package. This will not change the significance of our results, but will provide standardized path estimates which can be more interpretable than non-standardized estimates.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create standardized variables\ndata <- data %>% \n  mutate(affect_change_z = datawizard::standardize(affect_change),\n         psychdist_z = datawizard::standardize(psychdist))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nhead(data) %>%\n  kable()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> ID </th>\n   <th style=\"text-align:right;\"> Condition </th>\n   <th style=\"text-align:right;\"> Duration_minutes </th>\n   <th style=\"text-align:right;\"> psychdist </th>\n   <th style=\"text-align:right;\"> affect_change </th>\n   <th style=\"text-align:right;\"> WC </th>\n   <th style=\"text-align:right;\"> affect_change_z </th>\n   <th style=\"text-align:right;\"> psychdist_z </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 401 </td>\n   <td style=\"text-align:right;\"> -0.625 </td>\n   <td style=\"text-align:right;\"> 30.3 </td>\n   <td style=\"text-align:right;\"> 42.6 </td>\n   <td style=\"text-align:right;\"> -0.4932 </td>\n   <td style=\"text-align:right;\"> -1.2099 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 488 </td>\n   <td style=\"text-align:right;\"> 0.276 </td>\n   <td style=\"text-align:right;\"> 18.7 </td>\n   <td style=\"text-align:right;\"> 115.2 </td>\n   <td style=\"text-align:right;\"> -0.7104 </td>\n   <td style=\"text-align:right;\"> 0.4951 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 3 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 596 </td>\n   <td style=\"text-align:right;\"> 0.652 </td>\n   <td style=\"text-align:right;\"> 109.6 </td>\n   <td style=\"text-align:right;\"> 48.5 </td>\n   <td style=\"text-align:right;\"> 0.9919 </td>\n   <td style=\"text-align:right;\"> 1.2069 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 4 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1232 </td>\n   <td style=\"text-align:right;\"> 0.146 </td>\n   <td style=\"text-align:right;\"> 35.2 </td>\n   <td style=\"text-align:right;\"> 79.7 </td>\n   <td style=\"text-align:right;\"> -0.4009 </td>\n   <td style=\"text-align:right;\"> 0.2498 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 5 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 717 </td>\n   <td style=\"text-align:right;\"> -0.015 </td>\n   <td style=\"text-align:right;\"> 57.2 </td>\n   <td style=\"text-align:right;\"> 33.1 </td>\n   <td style=\"text-align:right;\"> 0.0114 </td>\n   <td style=\"text-align:right;\"> -0.0553 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 6 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> -492 </td>\n   <td style=\"text-align:right;\"> 0.198 </td>\n   <td style=\"text-align:right;\"> 36.9 </td>\n   <td style=\"text-align:right;\"> 121.9 </td>\n   <td style=\"text-align:right;\"> -0.3689 </td>\n   <td style=\"text-align:right;\"> 0.3470 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nWe now have two extra columns (affect_change_z and psychdist_z) which contain the standardized values of psychdist and affect_change, respectively.\n\nFor the mediation, we will use the [mediation]{style=\"color:blue;\"} package. We need to define **3** linear regression models:\n\n1.  **Total Effect: DV \\~ IV**\n\nThis will give us the the estimate for **path c** i.e., the **total effect**.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit.totaleffect = lm(affect_change_z ~ Condition, data)\nsummary(fit.totaleffect)$coefficients\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n            Estimate Std. Error t value Pr(>|t|)\n(Intercept)  -0.0224     0.0447  -0.501    0.617\nCondition     0.0448     0.0633   0.708    0.479\n```\n:::\n:::\n\n\n2.  **Effect of IV on Mediator: M \\~ IV**\n\nThis will give us the estimate for **path a**.\n\n\n::: {.cell}\n\n```{.r .cell-code}\noptions(digits=3)\nfit.mediator =  lm(psychdist_z ~ Condition, data)\nsummary(fit.mediator)$coefficients\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n            Estimate Std. Error t value        Pr(>|t|)\n(Intercept)   -0.204     0.0438   -4.67 0.0000034460595\nCondition      0.409     0.0619    6.60 0.0000000000656\n```\n:::\n:::\n\n\n3.  **Effect of Mediator on DV, while controlling for IV: DV \\~ IV + Mediator**\n\nThis will give us the estimate for the **direct effect** of the IV on the DV, as well as **path b** of the mediation model.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit.dv = lm(affect_change_z ~ Condition + psychdist_z, data)\nsummary(fit.dv)$coefficients\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n            Estimate Std. Error t value   Pr(>|t|)\n(Intercept)  0.00917     0.0447   0.205 0.83749942\nCondition   -0.01835     0.0639  -0.287 0.77411865\npsychdist_z  0.15445     0.0320   4.831 0.00000158\n```\n:::\n:::\n\n\nNow, we can run the mediation analysis using the [mediation]{style=\"color:blue;\"} function. We need to specify the model for the mediator (regression 2), the model for outcome (regression 3), the treatment variables (Condition) and the mediator (psychdist_z). Then we specify how many bootstrap samples we want and the type of confidence interval we want. Here I have used 10,000 samples with bias-corrected and accelerated (BCa) confidence intervals. Make sure you set a seed before running so that you can get reproducible results each time!\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123)\nresults = mediation::mediate(fit.mediator, fit.dv, treat='Condition', mediator='psychdist_z', sims = 10000, boot=T, boot.ci.type = \"bca\")\n```\n:::\n\n\nThis gives us the following output:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(results)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCausal Mediation Analysis \n\nNonparametric Bootstrap Confidence Intervals with the BCa Method\n\n               Estimate 95% CI Lower 95% CI Upper             p-value    \nACME             0.0632       0.0349         0.10 <0.0000000000000002 ***\nADE             -0.0183      -0.1433         0.11                0.80    \nTotal Effect     0.0448      -0.0775         0.17                0.47    \nProp. Mediated   1.4094      -4.6540        30.45                0.47    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nSample Size Used: 1000 \n\n\nSimulations: 10000 \n```\n:::\n:::\n\n\n**ACME** stands for *average causal mediation effects*. This is the indirect, or mediation, effect of the IV on the DV. From this, we can see whether we have a significant mediation effect or not. Here, *p* \\< .001, so we can conclude that linguistic distance does mediate the effect of Condition on affect change. Note that the mediation effect estimate = **path a** \\* **path b,** the values of which we found previously (0.06 = 0.40 \\* 0.15).\n\n**ADE** stands for *average direct effects*. This estimate is the effect of the IV on the DV, once we have controlled for the mediator. You can see that this estimate is equal to that found in **regression 3**.\n\n**Total Effect** equals the sum of the direct and indirect effects of the IV on the DV. This is what we found in **regression 1.**\n\n**Prop. Mediated** gives the size of the average causal mediation effects relative to the total effect. In this case, we get a value greater than 1. This indicates that the size of the mediation effect is larger than the total.\n\n### Interpretation\n\nWe can conclude that linguistic distance does act as a mediator of the association between condition (control or distanced) and pre- to post-reappraisal affect change. The distancing manipulation increases linguistic distance, and this is associated with greater affect change. Here is our final mediation model:\n\n![](mediation_paths.png){fig-align=\"center\" width=\"80%\"}\n\nThe results of this particular analysis are a little confusing: how can we have a significant mediation effect without a total effect? One reason for this may be an unmeasured variable acting as a mediator in the opposite direction. For example, maybe the distanced group are writing more during their reappraisal and experiencing the scenario more vividly, making it harder to reduce their negative affect. Using our WC (word count) variable, we can test whether word count differs by condition using a t-test:\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nt.test(WC ~ Condition, data=data) %>% \n  report_table() %>%\n  summary()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nDifference |           95% CI | t(992.23) |      p |     d\n----------------------------------------------------------\n-19.76     | [-26.97, -12.55] |     -5.38 | < .001 | -0.34\n\nAlternative hypothesis: two.sided\n```\n:::\n:::\n\n\nThese results indicate that word count is indeed higher for the distanced group than the control group, *p* \\< .001. But does word count interact with condition to predict affect change? We can run a regression model including the WC\\*Condition interaction term to test this:\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nsummary(lm(affect_change ~ WC*Condition, data=data))$coefficients\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n             Estimate Std. Error t value              Pr(>|t|)\n(Intercept)   39.4170     4.5731   8.619 0.0000000000000000262\nWC             0.1730     0.0424   4.083 0.0000479281634697070\nCondition      6.6799     6.7735   0.986 0.3242864160600559265\nWC:Condition  -0.0687     0.0577  -1.189 0.2346184845326609314\n```\n:::\n:::\n\n\nNo! There is no significant interaction effect between word count and condition. (And, we can see that actually the greater the word count, the greater the affect change. So it would definitely not be acting as an opposing mediator in this situation).\n\nWe have answered the 4 research questions outlined in the Intro, but the interpretation of the mediation results remains uncertain and opens up even more questions. In reality, it is unlikely that there will be a straightforward mediation of an effect, where one mediator fully mediates the association between your IV and DV. It is important to think about other potential mediators, as well as confounders in your study, when carrying out this kind of analysis. Study design is key - ideally, randomized controlled trials should be carried out before running a mediation model.\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}